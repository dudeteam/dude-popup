<!--
Copyright (c) 2015 DudeTeam. All rights reserved.
-->
<link rel="import" href="../polymer/polymer.html">

<!--
`dude-popup` is a Polymer element to create a popup which can be canceled by pressing escape.

@group dude Elements
@element dude-popup
@demo demo/index.html
-->
<dom-module id="dude-popup">
    <style>
    </style>
    <template>

    </template>
    <script>
        Polymer({
            is: "dude-popup",

            ready: function () {
                this._popupElement = document.createElement("div");
                this._popupElement.id = "popup";
                this._popupElement.style.zIndex = 9999;
                this._popupElement.style.display = "block";
                this._popupElement.style.position = "absolute";
                this._popupElement.setAttribute("hidden", "");
                this._popupElement.appendChild(Polymer.dom(this).querySelector("*"));
                document.body.appendChild(this._popupElement);
            },

            open: function (x, y) {
                if (this.isOpened()) {
                    if (this._outOfRect(x, y)) {
                        this.close();
                    }
                    return;
                }
                this._popupElement.removeAttribute("hidden");
                var rect = this._popupElement.getBoundingClientRect();
                var width = rect.right - rect.left;
                var height = rect.bottom - rect.top;
                if (x + width > window.innerWidth) {
                    this._popupElement.style.left = x - width + "px";
                } else {
                    this._popupElement.style.left = x + "px";
                }
                if (y + height > window.innerHeight) {
                    this._popupElement.style.top = y - height + "px";
                } else {
                    this._popupElement.style.top = y + "px";
                }
            },

            close: function () {
                this._popupElement.setAttribute("hidden", "");
            },

            isOpened: function () {
                return !this._popupElement.hasAttribute("hidden");
            },

            _outOfRect: function (x, y) {
                var rect = this._popupElement.getBoundingClientRect();
                return x < rect.left || x > rect.right || y < rect.top || y > rect.bottom;
            }
        });
    </script>
</dom-module>
