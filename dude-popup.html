<!--
Copyright (c) 2015 DudeTeam. All rights reserved.
-->
<link rel="import" href="../polymer/polymer.html">

<!--
`dude-popup` is a Polymer element boilerplate for dude library.

@group dude Elements
@element dude-popup
@demo demo/index.html
-->
<dom-module id="dude-popup">
    <style>
        #popup {
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 9999;
        }
    </style>
    <template>
        <div id="popup" hidden>
            <content></content>
        </div>
    </template>
    <script>
        Polymer({
            is: "dude-popup",
            isOpen: function () {
                return !this.$.popup.hasAttribute("hidden");
            },
            close: function () {
                this.$.popup.setAttribute("hidden", "");
            },
            open: function (x, y) {
                if (this.isOpen()) {
                    if (this._outOfRect(x, y)) {
                        this.close();
                    }
                    return;
                }
                this.$.popup.removeAttribute("hidden");
                var rect = this.$.popup.getBoundingClientRect();
                var width = rect.right - rect.left;
                var height = rect.bottom - rect.top;
                if (x + width > window.innerWidth) {
                    this.$.popup.style.left = x - width + "px";
                } else {
                    this.$.popup.style.left = x + "px";
                }
                if (y + height > window.innerHeight) {
                    this.$.popup.style.top = y - height + "px";
                } else {
                    this.$.popup.style.top = y + "px";
                }
            },
            _outOfRect: function (x, y) {
                this.$.popup.setAttribute("hidden", "");
                var rect = this.$.popup.getBoundingClientRect();
                return x < rect.left || x > rect.right || y < rect.top || y > rect.bottom;
            }
        });
    </script>
</dom-module>
